---
title: Set Up Auto-Enrollment (Preview)
description: Set Up Automatic Enrollment for Registered Devices
version: '14.x'
---

Auto-enrollment allows `tsh` to automatically enroll devices already registered
in Teleport during the user's login. The registration may be
[manual](/ver/14.x/access-controls/device-trust/guide#step-12-register-a-trusted-device) or performed using an
integration, like the [Jamf integration](/ver/14.x/access-controls/device-trust/jamf-integration).

<Warning>
  Device Trust is currently in Preview mode.
</Warning>

## Prerequisites

<Tabs>
  <Tab title="Enterprise">
    - A running Teleport Enterprise cluster, including the Auth Service and Proxy Service. For
      details on how to set this up, see our Enterprise [Getting
      Started](/ver/14.x/choose-an-edition/teleport-enterprise/introduction) guide.

    - The Enterprise `tctl` admin tool and `tsh` client tool version >= 14.0.0-dev,
      which you can download by visiting your [Teleport account](https://teleport.sh).

      ```code
      $ tctl version
      # Teleport Enterprise v14.0.0-dev go1.20

      $ tsh version
      # Teleport v14.0.0-dev go1.20
      ```
  </Tab>

  <Tab title="Teleport Enterprise Cloud">
    - A Teleport Enterprise Cloud account. If you do not have one, visit the [signup
      page](https://goteleport.com/signup/) to begin a free trial of Teleport Team
      and upgrade to Teleport Enterprise Cloud.

    - The `tctl` admin tool and `tsh` client tool version >= 13.2.0.
      To download these tools, visit the [Downloads](/ver/14.x/choose-an-edition/teleport-cloud/downloads) page.

      ```code
      $ tctl version
      # Teleport Enterprise v13.2.0 go1.20

      $ tsh version
      # Teleport v13.2.0 go1.20
      ```
  </Tab>
</Tabs>

- To enroll a macOS device, you need:
  - A signed and notarized `tsh` binary for enrollment.
    [Download the macOS tsh installer](/ver/14.x/installation#macos).
  - A Teleport version newer than v12.0.0.
- To enroll a Windows device, you need:
  - A device that includes a TPM with 2.0 support.
  - `tsh` installed on the device. [Download the Windows tsh installer](/ver/14.x/installation#windows-tsh-client-only).
  - Credentials for a user with administrator privileges for the device. This is only required during enrollment.
  - A Teleport version newer than v13.1.2.

- [A previously-registered device](/ver/14.x/access-controls/device-trust/guide#step-12-register-a-trusted-device) is necessary for
  auto-enrollment to take place.

## Step 1/2. Enable auto-enrollment

Enable auto-enrollment in your cluster settings:

<Tabs dropDownCaption="Teleport Deployment">
  <Tab title="Dynamic Resources">
    Modify the dynamic config resource using `tctl edit cluster_auth_preference`:

    ```diff
    kind: cluster_auth_preference
    version: v2
    metadata:
      name: cluster-auth-preference
    spec:
      # ...
      device_trust:
        mode: "required"
    +   auto_enroll: true
    ```
  </Tab>

  <Tab title="Static Config">
    Edit the Auth Server's `teleport.yaml` file:

    ```diff
    auth_service:
      authentication:
        # ...
        device_trust:
    +     auto_enroll: true
    ```

    After saving the changes, restart the Teleport service.
  </Tab>
</Tabs>

## Step 2/2. Login using a registered device

Using a device previously registered in Teleport, logout and login again:

```code
$ tsh logout
$ tsh login --proxy=teleport.example.com --user=alice
All users logged out.
Enter password for Teleport user alice:
Tap any security key
Detected security key tap
> Profile URL:        https://teleport.example.com:443
  Logged in as:       alice
  Cluster:            teleport.example.com
  Roles:              access, editor
  Logins:             alice
  Kubernetes:         enabled
  Valid until:        2023-06-23 02:47:05 -0300 -03 [valid for 12h0m0s]
  Extensions:         teleport-device-asset-tag, teleport-device-credential-id, teleport-device-id
```

The presence of the **teleport-device-\*** extensions shows that the device was
successfully enrolled and authenticated.

## Troubleshooting

### "binary missing signature or entitlements" on `tsh device enroll`

A signed and notarized `tsh` binary is necessary to enroll and use a a trusted
device. [Download the macOS tsh installer](/ver/14.x/installation#macos) to fix
the problem.

### "unauthorized device" errors using a trusted device

A signed and notarized `tsh` binary is necessary to use a trusted device. Make
sure to download and use the
[macOS tsh installer](/ver/14.x/installation#macos).

A trusted device needs to be registered and enrolled before it is recognized by
Teleport as such. Follow the [registration](/ver/14.x/access-controls/device-trust/guide#step-12-register-a-trusted-device) and
[enrollment](/ver/14.x/access-controls/device-trust/guide#step-22-enroll-a-trusted-device) steps
and make sure to `tsh logout` and `tsh login` after enrollment is done.
